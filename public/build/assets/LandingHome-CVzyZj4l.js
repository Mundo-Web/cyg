var Z=Object.defineProperty;var _=(m,t,o)=>t in m?Z(m,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[t]=o;var D=(m,t,o)=>(_(m,typeof t!="symbol"?t+"":t,o),o);import{j as e}from"./RequirementCard-DEdD30eg.js";import{r as c}from"./index-RYns6xqu.js";import{c as ee}from"./ReactAppend-vpV7VTGG.js";import{B as re}from"./Base-BAV8XZ7M.js";import{C as se}from"./CreateReactScript-BuKYEKxn.js";import{M as te}from"./Modal-1_SBF_XS.js";import{I as U}from"./InputFormGroup-B7mKwzkx.js";import{I as ne}from"./ImageFormGroup-Csvj9Cte.js";import"./sweetalert2.all-DJo0UVK6.js";import{T as ie}from"./TextareaFormGroup-B4XWcpu0.js";import{m as y}from"./main-Y8JAyXgE.js";import{B as oe}from"./Results-BBVbNL2k.js";import"./index-CXU7o9CY.js";import"./tippy-react.esm-DYFqe69e.js";/* empty css              */import"./Logout-BlWggqgx.js";import"./index.esm-zkRd-kwu.js";import"./axios-B4uVmeYG.js";import"./___vite-browser-external_commonjs-proxy-DbMF7jdq.js";import"./useTranslation-CZbMeh78.js";import"./Filter-CpekYgBC.js";/* empty css               */const ce=({id:m,col:t="col-12",label:o,eRef:a,required:p=!1,onChange:B=()=>{},onError:F="/api/cover/thumbnail/null"})=>{const[T,N]=c.useState(""),I=c.useRef(),v=c.useRef();c.useEffect(()=>{a&&(a.current={getFile:()=>I.current.files[0],setVideoSrc:h=>{N(h),v.current.src=h}})},[a]);const V=h=>{const M=h.target.files[0];if(M){const G=URL.createObjectURL(M);N(G),B(h)}};return e.jsxs("div",{className:`form-group ${t} mb-1`,children:[e.jsxs("label",{htmlFor:m,className:"mb-1",children:[o," ",p&&e.jsx("b",{className:"text-danger",children:"*"})]}),e.jsx("video",{ref:v,controls:!0,src:T,style:{width:"100%",borderRadius:"4px",background:"#000",display:T?"block":"none"},onError:h=>{h.target.src=F}}),e.jsx("input",{id:m,type:"file",ref:I,accept:"video/*",onChange:V,className:"form-control mt-2"})]})};class ae extends oe{constructor(){super(...arguments);D(this,"path","admin/landing_home");D(this,"hasFiles",!0);D(this,"translate",async o=>{try{const{status:a,result:p}=await y.Fetch(`/api/${this.path}/translate`,{method:"POST",body:JSON.stringify(o)});if(!a)throw new Error((p==null?void 0:p.message)||"Error al guardar traducción");return p}catch(a){return y.Notify.error(a.message),null}});D(this,"getByLang",async o=>{try{const{status:a,result:p}=await y.Fetch(`/api/${this.path}/by_lang/${o}`);if(!a)throw new Error((p==null?void 0:p.message)||"Error al obtener traducciones");return p}catch(a){return y.Notify.error(a.message),null}})}}const q=new ae,le=m=>{if(!m)return"home";const t=m.split("_");return t.length<2?"home":t[1]},z=({data:m,field:t,currentLangId:o,defaultLangId:a,onSave:p})=>{const[B,F]=c.useState(m[t]||""),[T,N]=c.useState(!1),I=o===a,v=!I,V=()=>{p(t,B),N(!1)};return e.jsx("div",{className:`d-flex gap-2 align-items-center ${v?"translation-field":""}`,children:I?e.jsx("span",{children:m[t]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"form-control flex-grow-1",value:B,onChange:h=>{F(h.target.value),N(!0)},disabled:!v}),T&&v&&e.jsx("button",{className:"btn btn-xs btn-soft-primary",onClick:V,children:e.jsx("i",{className:"fa fa-save"})})]})})},ue=({items:m,current_lang_id:t,default_lang_id:o})=>{const a=c.useRef(),[p,B]=c.useState("home"),[F,T]=c.useState(!1),[N,I]=c.useState(!1);c.useState("");const[v,V]=c.useState(m),[h,M]=c.useState({}),[G,J]=c.useState(!1),R=c.useRef(null),S=c.useRef(null),E=c.useRef(null),w=c.useRef(null),l=c.useRef(null),L=c.useRef(null),k=c.useRef(null),[X,K]=c.useState(null),H={home:"Inicio",services:"Servicios",infoproducts:"InfoProductos",aboutus:"Nosotros",contact:"Contacto",blog:"Blog"};c.useEffect(()=>{(async()=>{if(t!==o){J(!0);try{const n=await q.getByLang(t),d={};n.forEach(s=>{s.original_id&&(d[s.original_id]=s)}),M(d)}catch(n){y.Notify.error("Error al cargar traducciones"),console.error("Error loading translations:",n)}finally{J(!1)}}else M({})})()},[t,o]);const A=v.reduce((r,n)=>{const d=le(n.correlative);r[d]||(r[d]=[]);const s=h[n.original_id||n.id]||{},j={...n,title:t!==o&&s.title||n.title,subtitle:t!==o&&s.subtitle||n.subtitle,description:t!==o&&s.description||n.description,link:t!==o&&s.link||n.link,is_translated:!!s.id};return r[d].push(j),r},{});c.useEffect(()=>{var r;console.log("Items agrupados:",A),console.log("Items en home:",(r=A.home)==null?void 0:r.length),console.log("Total items:",v.length)},[A,v]),c.useEffect(()=>{console.log("Items cambiaron, total:",v.length)},[v]);const Q=r=>{r!=null&&r.id?T(!0):(T(!1),setTimeout(()=>{R.current&&(R.current.value=""),S.current&&(S.current.value=""),E.current&&(E.current.value=""),w.current&&(w.current.value=""),k.current&&(k.current.value=""),l.current&&(l.current.value="",setTimeout(()=>{l.current&&l.current.image&&(l.current.image.src="")},50)),I(!1)},50));const n=(r==null?void 0:r.is_video)==="1"||(r==null?void 0:r.is_video)===1;I(n),setTimeout(()=>{r!=null&&r.id&&(R.current&&(R.current.value=(r==null?void 0:r.id)??""),S.current&&(S.current.value=(r==null?void 0:r.title)??""),E.current&&(E.current.value=(r==null?void 0:r.subtitle)??""),w.current&&(w.current.value=(r==null?void 0:r.description)??""),k.current&&(k.current.value=(r==null?void 0:r.link)??""),n&&L.current&&(r!=null&&r.video)?L.current.setVideoSrc(`/api/landing_home/video/${r.video}`):!n&&l.current&&(r!=null&&r.image)&&setTimeout(()=>{if(l.current){const s=`/api/landing_home/media/${r.image}`;console.log("Cargando imagen en modal:",s),console.log("ImageRef.current:",l.current),console.log("ImageRef.current.image:",l.current.image),l.current.src=s,K(s)}else console.log("ImageRef o image no disponible:",{imageRef:!!l.current,image:!!(l.current&&l.current.image)})},100))},300),new bootstrap.Modal(a.current).show()},Y=async r=>{var n,d,s,j,g,x,u;r.preventDefault();try{const b=new FormData;if((n=R.current)!=null&&n.value&&b.append("id",R.current.value),(d=S.current)!=null&&d.value&&b.append("title",S.current.value),(s=E.current)!=null&&s.value&&b.append("subtitle",E.current.value),(j=w.current)!=null&&j.value&&b.append("description",w.current.value),(g=k.current)!=null&&g.value&&b.append("link",k.current.value),b.append("lang_id",o),N&&L.current){const i=L.current.getFile();i&&b.append("video",i)}else!N&&((u=(x=l.current)==null?void 0:x.files)!=null&&u[0])&&b.append("image",l.current.files[0]);const C=await q.save(b);if(!C){y.Notify.error("Error al guardar la sección");return}console.log("Resultado del save:",C),V(F?i=>i.map(f=>f.id===C.data.id?C.data:f):i=>[C.data,...i]);try{const i=await q.paginate({page:1,per_page:1e3,search:"",orderBy:"created_at",order:"desc"});if(console.log("Respuesta completa de paginate:",i),i){let f=null;i.data&&Array.isArray(i.data)?f=i.data:i.result&&i.result.data&&Array.isArray(i.result.data)?f=i.result.data:Array.isArray(i)&&(f=i),console.log("Items extraídos:",f),f&&f.length>=0&&(V(f),console.log("Items actualizados desde servidor:",f.length))}}catch(i){console.warn("Error al recargar desde servidor, usando actualización local",i)}try{const i=a.current.querySelector(".btn-close");if(i)i.click();else{const f=a.current.querySelector('[data-bs-dismiss="modal"]');if(f)f.click();else{const W=bootstrap.Modal.getInstance(a.current);W?W.hide():new bootstrap.Modal(a.current).hide()}}}catch(i){console.error("Error al cerrar modal:",i),$(a.current).modal("hide")}setTimeout(()=>{R.current&&(R.current.value=""),S.current&&(S.current.value=""),E.current&&(E.current.value=""),w.current&&(w.current.value=""),k.current&&(k.current.value=""),l.current&&(l.current.value="",setTimeout(()=>{l.current&&l.current.image&&(l.current.image.src="")},50)),L.current&&typeof L.current.clearVideo=="function"&&L.current.clearVideo(),I(!1),T(!1),K(null)},200),y.Notify.success("Sección guardada correctamente")}catch(b){console.error("Error al enviar el formulario:",b),y.Notify.error("Hubo un error al enviar el formulario")}},O=async(r,n,d)=>{var s,j,g,x;try{const u=v.find(i=>i.id===r);if(!u)return;const b={original_id:u.original_id||u.id,[n]:d,lang_id:t,title:n==="title"?d:((s=h[u.id])==null?void 0:s.title)||u.title,subtitle:n==="subtitle"?d:((j=h[u.id])==null?void 0:j.subtitle)||u.subtitle,description:n==="description"?d:((g=h[u.id])==null?void 0:g.description)||u.description,link:n==="link"?d:((x=h[u.id])==null?void 0:x.link)||u.link},C=await q.translate(b);if(!C)return;M(i=>{const f={...i};return f[u.id]||(f[u.id]={...u,id:C.id,original_id:u.id,lang_id:t}),f[u.id][n]=d,f}),y.Notify.success("Traducción guardada correctamente")}catch(u){y.Notify.error("Error al guardar traducción"),console.error(u)}},P=t!==o;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`card ${P?"translation-mode":""}`,children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("ul",{className:"nav nav-tabs card-header-tabs",children:Object.keys(H).map(r=>e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:`nav-link ${p===r?"active":""}`,onClick:()=>B(r),children:H[r]})},r))}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[P&&e.jsxs("span",{className:"badge bg-success me-2",style:{padding:"6px"},children:[e.jsx("i",{className:"fa fa-language me-1"})," Modo Traducción"]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>Q({correlative:`page_${p}_new`,lang_id:o}),children:[e.jsx("i",{className:"fa fa-plus me-1"})," Nueva Sección"]})]})]}),e.jsx("div",{className:"card-body",children:G?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})}),e.jsx("p",{className:"mt-2",children:"Cargando traducciones..."})]}):Object.keys(H).map(r=>{var n,d;return e.jsxs("div",{style:{display:p===r?"block":"none"},children:[e.jsxs("h4",{className:"mb-4",children:["Secciones de ",H[r]]}),e.jsxs("p",{className:"text-muted mb-3",children:["Mostrando ",((n=A[r])==null?void 0:n.length)||0," ","secciones"]}),((d=A[r])==null?void 0:d.length)===0?e.jsx("div",{className:"alert alert-info",children:"No hay secciones configuradas para esta página"}):e.jsx("div",{className:"row",children:(A[r]||[]).map(s=>{var j;return e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("div",{className:"card-header d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0",children:[((j=s.correlative)==null?void 0:j.split("_")[2])||"Sección",e.jsxs("small",{className:"text-muted ms-2",children:["(",s.correlative,")"]})]})}),e.jsxs("div",{className:"card-body",children:[s.is_video==="1"||s.is_video===1?e.jsx("video",{src:`/api/landing_home/video/${s.video}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:g=>g.target.src="/api/cover/thumbnail/null",controls:!0}):s.image?e.jsx("img",{src:`/api/landing_home/media/${s.image}`,className:"img-fluid mb-3",style:{maxHeight:"200px",width:"100%",objectFit:"cover"},onError:g=>g.target.src="/api/cover/thumbnail/null"}):e.jsx("div",{className:"bg-light mb-3",style:{height:"200px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{className:"text-muted",children:"Sin imagen/video"})}),s.title&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Título:"}),e.jsx(z,{data:s,field:"title",currentLangId:t,defaultLangId:o,onSave:(g,x)=>O(s.id,g,x)})]}),s.subtitle&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Subtítulo:"}),e.jsx(z,{data:s,field:"subtitle",currentLangId:t,defaultLangId:o,onSave:(g,x)=>O(s.id,g,x)})]}),s.description&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Descripción:"}),e.jsx(z,{data:s,field:"description",currentLangId:t,defaultLangId:o,onSave:(g,x)=>O(s.id,g,x)})]}),s.link&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Enlace:"}),e.jsx(z,{data:s,field:"link",currentLangId:t,defaultLangId:o,onSave:(g,x)=>O(s.id,g,x)})]})]}),e.jsx("div",{className:"card-footer d-flex justify-content-end",children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>Q(s),disabled:P,children:[e.jsx("i",{className:"fa fa-edit"})," ","Editar"]})})]})},s.id)})})]},r)})})]}),e.jsx(te,{modalRef:a,title:F?"Editar sección":"Agregar sección",onSubmit:Y,size:"lg",children:e.jsxs("div",{className:"row",id:"principal-container",children:[e.jsx("input",{ref:R,type:"hidden"}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(U,{eRef:S,label:"Título",placeholder:"Título principal de la sección",required:!0}),e.jsx(U,{eRef:E,label:"Subtítulo",placeholder:"Subtítulo opcional"}),e.jsx(ie,{eRef:w,label:"Descripción",rows:3,placeholder:"Descripción detallada de la sección"}),e.jsx(U,{eRef:k,label:"Enlace",placeholder:"https://ejemplo.com"})]}),e.jsx("div",{className:"col-md-6",children:N?e.jsx(ce,{eRef:L,label:"Video",col:"col-12",required:!F}):e.jsx(ne,{eRef:l,label:"Imagen",col:"col-12",aspect:16/9,fit:"contain",src:X})})]})})]})};se((m,t)=>{ee(m).render(e.jsx(re,{...t,title:"Landing Inicio",children:e.jsx(ue,{...t})}))});
